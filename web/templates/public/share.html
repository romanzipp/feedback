{{template "layouts/base.html" .}}

{{define "title"}}{{.Share.Name}}{{end}}

{{define "content"}}
<div class="max-w-6xl mx-auto">
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-900 mb-2">{{.Share.Name}}</h1>
        {{if .Share.Description}}
        <p class="text-gray-600">{{.Share.Description}}</p>
        {{end}}
    </div>

    {{if not .Username}}
    <div class="mb-8 bg-white border border-gray-200 rounded-lg p-6">
        <h2 class="text-xl font-semibold text-gray-900 mb-4">Enter Your Name</h2>
        <form method="POST" action="/share/{{.Hash}}/name" class="flex gap-4">
            <input type="text" name="username" required placeholder="Your name"
                   class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary">
            <button type="submit" class="bg-primary text-white px-6 py-2 rounded hover:bg-blue-600">
                Continue
            </button>
        </form>
    </div>
    {{else}}
    <p class="mb-8 text-gray-600">Logged in as: <strong>{{.Username}}</strong></p>
    {{end}}

    {{if .Files}}
    <div class="grid gap-8">
        {{range .Files}}
        <div class="bg-white border border-gray-200 rounded-lg p-6">
            <div class="mb-4">
                {{if and (ne .MimeType "") (hasPrefix .MimeType "image/")}}
                <img src="/files/{{.ID}}" alt="{{.Filename}}" class="max-w-full h-auto rounded cursor-pointer hover:opacity-90" data-file-id="{{.ID}}" onclick="openModal({{.ID}})">
                {{else}}
                <a href="/files/{{.ID}}" target="_blank" class="text-primary hover:underline text-lg font-medium">{{.Filename}}</a>
                {{end}}
            </div>

            <div class="border-t pt-4">
                <h3 class="font-semibold text-gray-900 mb-4">Comments</h3>
                <div id="comments-{{.ID}}" class="space-y-3 mb-4">
                    {{range .Comments}}
                    <div class="bg-gray-50 rounded p-3">
                        <div class="flex items-baseline gap-2 mb-1">
                            <span class="font-medium text-gray-900">{{.Username}}</span>
                            <span class="text-sm text-gray-500">{{.CreatedAt.Format "2006-01-02 15:04"}}</span>
                        </div>
                        <p class="text-gray-700">{{.Content}}</p>
                    </div>
                    {{end}}
                </div>

                {{if $.Username}}
                <form class="comment-form" data-file-id="{{.ID}}">
                    <textarea name="content" required placeholder="Add a comment..." rows="3"
                              class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary mb-2"></textarea>
                    <button type="submit" class="bg-primary text-white px-4 py-2 rounded hover:bg-blue-600">
                        Post Comment
                    </button>
                </form>
                {{end}}
            </div>
        </div>
        {{end}}
    </div>
    {{else}}
    <p class="text-gray-500">No files available yet.</p>
    {{end}}
</div>

<div id="modal" class="fixed inset-0 bg-black bg-opacity-90 hidden items-center justify-center z-50" onclick="closeModal()">
    <div class="max-w-7xl max-h-full p-4">
        <img id="modal-img" src="" alt="" class="max-w-full max-h-screen object-contain">
    </div>
</div>
{{end}}

{{define "scripts"}}
<script src="/static/js/modal.js" type="module"></script>
<script src="/static/js/comments.js" type="module"></script>
<script>
function hasPrefix(str, prefix) {
    return str.indexOf(prefix) === 0;
}
</script>
{{end}}
